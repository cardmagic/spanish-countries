<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country Capital Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .hidden {
            display: none;
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        .shake {
            animation: shake 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
    <div class="bg-white p-8 rounded shadow-md w-96">
        <h1 class="text-2xl font-bold mb-4 text-center">Country Capital Quiz</h1>
        <div id="quiz-container">
            <div id="question" class="text-xl mb-4"></div>
            <div id="options" class="space-y-2"></div>
            <div id="score" class="mt-4 text-center text-lg font-semibold"></div>
        </div>
    </div>

    <script>
        const countries = [
            { name: "Argentina", capital: "Buenos Aires", mnemonic: "Argent-tina: Picture a shiny silver (argent) teacup (tina) filled with good air (Buenos Aires)" },
            { name: "Bolivia", capital: "La Paz", mnemonic: "BOLIVia: Imagine a bowl (BOL) full of pez candy (La Paz)" },
            { name: "Chile", capital: "Santiago", mnemonic: "CHILe: Visualize a Saint with Iago (the bird from Aladdin) eating a chile (CHILE) pepper (Santiago)" },
            { name: "Colombia", capital: "Bogotá", mnemonic: "CoLOMbia: Picture a giant lollipop (lom) with a bow and arrow (Bogotá) stuck in it" },
            { name: "Costa Rica", capital: "San José", mnemonic: "Costa Rica: Imagine a coffee costa (coast) where a rich (Rica) man named San José is surfing" },
            { name: "Cuba", capital: "Havana", mnemonic: "Cuba: Have a banana (Cuba) with a halo (Havana) on it" },
            { name: "Dominican Republic", capital: "Santo Domingo", mnemonic: "Dominican: Imagine a domino with a halo (Santo) falling on a Sunday (Domingo)" },
            { name: "Ecuador", capital: "Quito", mnemonic: "ECUAdor: Visualize an equator line with a mosquito (Quito) buzzing around it" },
            { name: "El Salvador", capital: "San Salvador", mnemonic: "El Salvador: Picture a savior (Salvador) saving a salad (sal) from falling off a table" },
            { name: "Equatorial Guinea", capital: "Oyala", mnemonic: "Equatorial Guinea: Imagine a guinea pig balancing on the equator line, yelling 'Oh ya la!'" },
            { name: "Guatemala", capital: "Guatemala City", mnemonic: "Guatemala: Picture a guava-flavored mala (bad) drink flooding the city" },
            { name: "Honduras", capital: "Tegucigalpa", mnemonic: "Honduras: Visualize hundreds of Honda cars playing tag with each other (Tegucigalpa)" },
            { name: "Mexico", capital: "Mexico City", mnemonic: "Mexico: Imagine a giant taco saying 'Mexi-can!' to a whole city" },
            { name: "Nicaragua", capital: "Managua", mnemonic: "Nicaragua: Picture a knight named Nick (Nic-aragua) in a canoe saying 'I'm a man in agua!' (Managua)" },
            { name: "Panama", capital: "Panama City", mnemonic: "Panama: Visualize a giant pan-shaped hat (Panama) covering the entire city" },
            { name: "Paraguay", capital: "Asunción", mnemonic: "Paraguay: Imagine a pair of guys assuming they can look at the sun, assuming sun (Asunción)" },
            { name: "Peru", capital: "Lima", mnemonic: "Peru: Picture a kangaroo (Peru) jumping over a giant lime (Lima)" },
            { name: "Spain", capital: "Madrid", mnemonic: "Spain: Visualize a spinning pain (Spain) turning into a smiling mad rid(er) on a bull" },
            { name: "Uruguay", capital: "Montevideo", mnemonic: "Uruguay: Imagine you're a guy (Uru-guy) watching a monte (mountain) video in Montevideo" },
            { name: "Venezuela", capital: "Caracas", mnemonic: "Venezuela: Picture a venezia (Venice) full of cars honking 'Car-acas! Car-acas!'" }
        ]

        const questionElement = document.getElementById('question')
        const optionsElement = document.getElementById('options')
        const scoreElement = document.getElementById('score')

        let totalQuestions = 0
        let correctAnswers = 0
        let incorrectCountries = {}
        let hintShown = false; // New variable to track if hint has been shown

        function getRandomInt(max) {
            return Math.floor(Math.random() * max)
        }

        function generateQuiz() {
            const randomCountryIndex = getRandomInt(countries.length)
            const correctCountry = countries[randomCountryIndex]
            const correctCapital = correctCountry.capital

            questionElement.textContent = `What is the capital of ${correctCountry.name}?`

            const options = new Set()
            options.add(correctCapital)

            while (options.size < 5) {
                const randomOption = countries[getRandomInt(countries.length)].capital
                options.add(randomOption)
            }

            const optionsArray = Array.from(options).sort(() => Math.random() - 0.5)
            optionsElement.innerHTML = ''

            optionsArray.forEach(option => {
                const button = document.createElement('button')
                button.textContent = option
                button.className = 'w-full py-2 px-4 bg-blue-500 text-white rounded hover:bg-blue-700'
                button.addEventListener('click', () => handleOptionClick(button, option, correctCapital))
                optionsElement.appendChild(button)
            })

            hintShown = false; // Reset hintShown for each new question

            // Add a hint button
            const hintButton = document.createElement('button')
            hintButton.textContent = 'Show Hint'
            hintButton.className = 'w-full py-2 px-4 bg-yellow-500 text-white rounded hover:bg-yellow-700 mt-2'
            hintButton.addEventListener('click', () => showHint(correctCountry.mnemonic))
            optionsElement.appendChild(hintButton)

            updateScore()
        }

        function showHint(mnemonic) {
            if (!hintShown) {
                const hintElement = document.createElement('p')
                hintElement.textContent = mnemonic
                hintElement.className = 'mt-2 text-sm text-gray-600 italic'
                optionsElement.appendChild(hintElement)
                hintShown = true;
            }
        }

        function handleOptionClick(button, selectedOption, correctOption) {
            totalQuestions++
            if (selectedOption === correctOption) {
                correctAnswers++
                button.classList.remove('bg-blue-500', 'hover:bg-blue-700')
                button.classList.add('bg-green-500')
                
                // Show congratulatory GIF if it's the first try
                if (totalQuestions === correctAnswers) {
                    showCongratulatoryGif()
                }
                
                setTimeout(() => {
                    button.classList.remove('bg-green-500')
                    button.classList.add('bg-blue-500', 'hover:bg-blue-700')
                    if (correctAnswers === 20) {
                        sendIncorrectCountries()
                    }
                    generateQuiz()
                }, 3000) // Increased timeout to allow time for GIF to be shown
            } else {
                const incorrectCountry = countries.find(country => country.capital === correctOption)
                if (incorrectCountry) {
                    incorrectCountries[incorrectCountry.name] = (incorrectCountries[incorrectCountry.name] || 0) + 1
                }
                button.classList.remove('bg-blue-500', 'hover:bg-blue-700')
                button.classList.add('bg-red-500', 'shake')
                // Vibrate for 500ms if the browser supports it
                if ('vibrate' in navigator) {
                    navigator.vibrate(500);
                }
                setTimeout(() => {
                    button.classList.remove('bg-red-500', 'shake')
                    button.classList.add('bg-blue-500', 'hover:bg-blue-700')
                    button.disabled = true
                }, 1000)

                // Show the mnemonic after an incorrect answer
                const correctCountry = countries.find(country => country.capital === correctOption)
                if (correctCountry) {
                    showHint(correctCountry.mnemonic)
                }
            }
            updateScore()
        }

        function showCongratulatoryGif() {
            fetch('https://api.giphy.com/v1/gifs/random?api_key=cPGAZEnhuSGQ9iKlFKvfuAQPmozexHRh&tag=congratulations')
                .then(response => response.json())
                .then(data => {
                    const gifUrl = data.data.images.original.url
                    const gifElement = document.createElement('img')
                    gifElement.src = gifUrl
                    gifElement.alt = data.data.alt_text || 'Congratulatory GIF'
                    gifElement.className = 'w-full h-auto mt-4 rounded'
                    
                    const container = document.getElementById('quiz-container')
                    container.appendChild(gifElement)
                    
                    setTimeout(() => {
                        container.removeChild(gifElement)
                    }, 3000)
                })
                .catch(error => console.error('Error fetching GIF:', error))
        }

        function sendIncorrectCountries() {
            const sortedIncorrectList = Object.entries(incorrectCountries)
                .sort((a, b) => b[1] - a[1])  // Sort by count in descending order
                .map(([country, count]) => `${country} (${count})`)
                .join(', ');

            const accuracy = totalQuestions > 0 ? ((correctAnswers / totalQuestions) * 100).toFixed(2) : 0;
            
            // Get the current day of the week
            const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayOfWeek = daysOfWeek[new Date().getDay()];

            const message = sortedIncorrectList.length > 0 
                ? `${dayOfWeek} Questions Answered: ${totalQuestions}, Accuracy: ${accuracy}%, Incorrectly answered countries: ${sortedIncorrectList}`
                : `${dayOfWeek} Questions Answered: ${totalQuestions}, Accuracy: ${accuracy}%, No countries were answered incorrectly!`;

            fetch('https://ntfy.sh/spanish-countries', {
                method: 'POST',
                body: message
            }).then(() => {
                console.log('Quiz results sent successfully');
                incorrectCountries = {}; // Reset the dictionary after sending
            }).catch(error => {
                console.error('Error sending quiz results:', error);
            });
        }

        function updateScore() {
            const percentage = totalQuestions > 0 ? ((correctAnswers / totalQuestions) * 100).toFixed(2) : 0
            scoreElement.textContent = `Questions Answered: ${totalQuestions}, Correct: ${correctAnswers}, Accuracy: ${percentage}%`
        }

        generateQuiz()
    </script>
</body>
</html>

